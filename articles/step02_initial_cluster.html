<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Step 2: Initial clustering • recolorize</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Step 2: Initial clustering">
<meta property="og:description" content="recolorize">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">recolorize</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Introduction.html">Introduction</a>
    </li>
    <li>
      <a href="../articles/step00_prep.html">Step 0: Image acquisition and preparation</a>
    </li>
    <li>
      <a href="../articles/step01_loading.html">Step 1: Loading &amp; processing images</a>
    </li>
    <li>
      <a href="../articles/step02_initial_cluster.html">Step 2: Initial clustering</a>
    </li>
    <li>
      <a href="../articles/step03_refinement.html">Step 3: Refinement</a>
    </li>
    <li>
      <a href="../articles/step04_manual_tweak.html">Step 4: Tweaks &amp; edits</a>
    </li>
    <li>
      <a href="../articles/step05_visualization_export.html">Step 5: Exporting &amp; visualizing output</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="step02_initial_cluster_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Step 2: Initial clustering</h1>
            
      
      
      <div class="hidden name"><code>step02_initial_cluster.Rmd</code></div>

    </div>

    
    
<blockquote>
<p>Go from thousands of colors to a manageable number for further refinement.</p>
</blockquote>
<ul>
<li>
<a href="Introduction.html">Introduction</a><br>
</li>
<li>
<a href="step00_prep.html">Step 0: Image acquisition and preparation</a><br>
</li>
<li>
<a href="step01_loading.html">Step 1: Loading &amp; processing images</a><br>
</li>
<li>Step 2: Initial clustering</li>
<li>
<a href="step03_refinement.html">Step 3: Refinement</a><br>
</li>
<li>
<a href="step04_manual_tweak.html">Step 4: Tweaks &amp; edits</a><br>
</li>
<li><a href="step05_visualization_export.html">Step 5: Visualizing &amp; exporting output</a></li>
</ul>
<blockquote>
<p>You can also tour the functions in the <a href="https://hiweller.rbind.io/post/function-gallery-for-recolorize/" class="external-link">function gallery</a>.</p>
</blockquote>
<p>The color clustering in recolorize usually starts with an initial clustering step which produces more color clusters than the final color map will have, which are then edited and combined to form the final color map. We start with an over-clustering step because it is a quick way to go from an overwhelming number of colors (<span class="math inline">\(256^3\)</span> unique RGB colors) to a manageable number that can be manually inspected or automatically re-clustered. You’ll usually do this using the <code>recolorize</code> function, which is the core of the package (go figure!):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hiweller.github.io/recolorize/">recolorize</a></span><span class="op">)</span>

<span class="co"># get path to image</span>
<span class="va">corbetti</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/corbetti.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span>

<span class="co"># cluster using defaults</span>
<span class="va">recolorize_defaults</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span>img <span class="op">=</span> <span class="va">corbetti</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 2^3 = 8 total bins</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/setup-1.png" width="384" style="display: block; margin: auto;"></p>
<p>This function does a lot under the hood: we read in the image as an array, indexed the background, binned every pixel in the image into one of eight bins in RGB color space, calculated the average color of all the pixels assigned to a given bin, recolored the image to show which pixel was assigned to which color center, and returned all of that information in the <code>recolorize_defaults</code> object. A good understanding of this function and the effects of the different options will help you manipulate it for your needs, so I’ll briefly explain how it works.</p>
<div class="section level3">
<h3 id="the-recolorize-function">The <code>recolorize</code> function<a class="anchor" aria-label="anchor" href="#the-recolorize-function"></a>
</h3>
<p>The main <code>recolorize</code> function has a simple goal: to take your image from a huge number of colors to a manageable number of color clusters. This falls under a category of methods for <a href="https://en.wikipedia.org/wiki/Color_quantization" class="external-link">color quantization</a>, although we have a slightly different goal here. The typical reason for doing color quantization is to simplify an image while making it look as visually similar as possible to the original; our goal is not to represent the original image, but to create a set of building blocks to combine and clean up so we can refer to whole color patches easily.</p>
<p>If you look at the documentation for the <code>recolorize</code> function, you’ll see a lot of user-specifiable parameters. There are only really 3 major ones:</p>
<ol style="list-style-type: decimal">
<li>the color space in which the clustering is done (<code>color_space</code>)</li>
<li>the clustering method (the <code>method</code> argument)</li>
<li>the number of color clusters (<code>bins</code> for <code>method = hist</code> and <code>n</code> for <code>method = kmeans</code>)</li>
</ol>
<p>You can also map an image to an externally imposed set of colors using another function, <code>imposeColors</code>, which can be useful for batch processing images.</p>
<p>We’ll go over each of these parameters and what they do. I’ll give mild advice about how to navigate these options, but there’s a reason I’ve included all of theme here, which is that I think any combination of these parameters can be useful depending on the context.</p>
<div class="section level4">
<h4 id="color-spaces">Color spaces<a class="anchor" aria-label="anchor" href="#color-spaces"></a>
</h4>
<p>Color spaces are ways to represent colors as points in multi-dimensional spaces, where each axis corresponds to some aspect of the color. You’re probably familiar with RGB (red-green-blue) color space and HSV (hue-saturation-value) color space. In RGB space, colors vary by the amount of red, green, and blue they have, where a coordinate of [0, 0, 1] would be pure blue (no red or green), [1, 1, 1] would be white, [0, 1, 1] would be cyan, etc. This is how most images are stored and displayed on computers, although it’s not always very intuitive.</p>
<p>The <code>recolorize</code> package gives you a variety of options for color spaces, but by far the two most commonly used are RGB (<code>color_space = sRGB</code>) and CIE Lab (<code>color_space = Lab</code>). CIE Lab is popular because it approximates perceptual uniformity, which means that the distances between colors in CIE Lab space are proportional to how different they actually seem to human beings. The axes represent luminance (L, 0 = black and 100 = white), red-green (a, negative values = more green and positive values = more red), and blue-yellow (b, negative values = more blue and positive values = more yellow). The idea is that something can be greenish-blue, or reddish-yellow, but not reddish-green, etc. This can be a little confusing, but the results it provides are really intuitive. For example, in RGB space, red is as similar to yellow as it is to black. In CIE Lab, red and yellow are close together, and are about equally far from black.</p>
<p>I’ve written in more detail about color spaces for another package <a href="https://CRAN.R-project.org/package=colordistance/vignettes/color-spaces.html" class="external-link">here</a>, which I would recommend reading for a more detailed overview, but let’s see what happens if we plot all of the non-background pixels from our <em>C. corbetti</em> example in RGB compared to CIE Lab color space (forgive the crummy plotting):</p>
<pre><code><span class="co">#&gt; Warning: no DISPLAY variable so Tk is not available</span></code></pre>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-3-1.png" width="576" style="display: block; margin: auto;"><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-3-2.png" width="576" style="display: block; margin: auto;"></p>
<p>We can identify green, red, blue, black, and white pixels in both sets of plots, but their distributions are very different.</p>
<p>In practice, I find myself toggling between these two color spaces depending on the color distributions in my images. For example, when dealing with <em>C. corbetti</em>, I would use RGB, because the beetle is literally red, green, and blue. When dealing with the red and green <em>C. fulgidissima</em> above, I found that CIE Lab produced better results, because it separates red and green pixels by much more distance. But in general, especially as you increase the number of initial clusters, this matters less at this stage than at the refinement stage (where you can switch between color spaces again). Because CIE Lab is not evenly distributed on all axes (i.e. is not a cube), you may need to use more bins in CIE Lab space than in RGB. (Try fitting the <em>C. corbetti</em> image with CIE Lab space and see what happens for an idea of how much the choice of color space can matter.)</p>
</div>
<div class="section level4">
<h4 id="clustering-methods">Clustering methods<a class="anchor" aria-label="anchor" href="#clustering-methods"></a>
</h4>
<p>The two clustering methods in <code>recolorize</code> are color histogram binning (fast, consistent, and deterministic) and k-means clustering (comparatively slower and heuristic, but more intuitive). The <code>bins</code> argument is accessed by the histogram method, and <code>n</code> goes with the kmeans method. I highly recommend the histogram binning unless you have a good reason not to use it, but there are good reasons to use k-means clustering sometimes.</p>
<p>The histogram binning method is essentially just a 3-dimensional color histogram: we divide up each channel of a color space into a predetermined number of bins, then count the number of pixels that fall into that bin and calculate their average color. So, when we divide each of 3 color channels into 2 bins, we end up with <span class="math inline">\(2^3 = 8\)</span> total bins (which is why setting <code>bins = 2</code> will produce 8 colors as above).</p>
<p>k-means clustering, on the other hand, is a well-known method for partitioning data into n clusters. You just provide the number of clusters you want, and it will try to find the best locations for them, where ‘best’ means minimizing the squared Euclidean distances between pixels and color centers within each cluster.</p>
<p>To appreciate these differences, we can fit the same number of colors (27) using the histogram method and the k-means method on the same image, then view the resulting color distributions:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit 64 colors, both ways</span>
<span class="va">r_hist</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, method <span class="op">=</span> <span class="st">"hist"</span>, bins <span class="op">=</span> <span class="fl">3</span>, plotting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 3^3 = 27 total bins</span>
<span class="va">r_k</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, method <span class="op">=</span> <span class="st">"k"</span>, n <span class="op">=</span> <span class="fl">37</span>, plotting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotColorClusters.html">plotColorClusters</a></span><span class="op">(</span><span class="va">r_hist</span><span class="op">$</span><span class="va">centers</span>, <span class="va">r_hist</span><span class="op">$</span><span class="va">sizes</span>, scaling <span class="op">=</span> <span class="fl">30</span>,
                  plus <span class="op">=</span> <span class="fl">.05</span>,
                  xlab <span class="op">=</span> <span class="st">"red"</span>, ylab <span class="op">=</span> <span class="st">"green"</span>, zlab <span class="op">=</span> <span class="st">"blue"</span>, 
                  main <span class="op">=</span> <span class="st">"Histogram method"</span>,
                  xlim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, ylim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, zlim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-4-1.png" width="336" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="../reference/plotColorClusters.html">plotColorClusters</a></span><span class="op">(</span><span class="va">r_k</span><span class="op">$</span><span class="va">centers</span>, <span class="va">r_k</span><span class="op">$</span><span class="va">sizes</span>, scaling <span class="op">=</span> <span class="fl">30</span>,
                  plus <span class="op">=</span> <span class="fl">.05</span>,
                  xlab <span class="op">=</span> <span class="st">"red"</span>, ylab <span class="op">=</span> <span class="st">"green"</span>, zlab <span class="op">=</span> <span class="st">"blue"</span>,
                  main <span class="op">=</span> <span class="st">"k-means clustering"</span>,
                  xlim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, ylim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span>, zlim <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-4-2.png" width="336" style="display: block; margin: auto;"></p>
<p>The histogram method produced a lot of tiny, nearly-empty clusters that are evenly distributed in the color space, with only a few large clusters (like the black and white ones). The k-means clustering method, on the other hand, produced a lot more medium-sized clusters, as well as splitting the black and white patches across multiple clusters.</p>
<p>A lot of color segmentation tools will <em>only</em> use k-means clustering (or a similar method), because it’s relatively easy to implement and does produce good results if your images have clear color boundaries and very different colors (i.e. the pixels are far apart in color space). If you were going to stop at the initial clustering step, this would probably be a better option than the histogram binning for that reason. The main reason I recommend against it is that it is not deterministic: you will get different colors, and in a different order, every time you run it. For example, if we fit 10 colors three separate times, we get the following color palettes:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, <span class="st">"k"</span>, n <span class="op">=</span> <span class="fl">10</span>, plotting <span class="op">=</span> <span class="cn">F</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/graphics/layout.html" class="external-link">layout</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">k_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">centers</span>, <span class="va">k_list</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sizes</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">k_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">centers</span>, <span class="va">k_list</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sizes</span><span class="op">)</span>
<span class="fu"><a href="../reference/plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">k_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">centers</span>, <span class="va">k_list</span><span class="op">[[</span><span class="fl">3</span><span class="op">]</span><span class="op">]</span><span class="op">$</span><span class="va">sizes</span><span class="op">)</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-5-1.png" width="384" style="display: block; margin: auto;"></p>
<p>The colors are similar, but not identical, and they are returned in an arbitrary order. If you run this code one day and pull out all the red clusters by their index, or merge the multiple green clusters, those values will change the next time you run the code. That and the need to specify cluster numbers for each image are more or less why I recommend not using this method unless you have a reason.</p>
<p>Binning the colors (histograms) is usually more viable as a first step. It’s quite fast, since we’re not really doing any clustering; the bins we assign the pixels to will be the same for every image, and we’re not calculating the distances between the pixels and their assigned color. It’s also deterministic, which means you get the same result every single time you run it. The downside is that makes this approach almost guaranteed to over-split colors, since your color regions will rarely fall cleanly within the boundaries of these bins, and many of the bins you end up with will be empty or have very few pixels.</p>
</div>
<div class="section level4">
<h4 id="number-of-clusters">Number of clusters<a class="anchor" aria-label="anchor" href="#number-of-clusters"></a>
</h4>
<p>Unlike the color space and binning method, this parameter is pretty intuitive: the more clusters you fit, the more the colors in your image will be split up. It’s convenient to use the same scheme for every image in your dataset, so you might end up using whatever values are needed for your most complex image and over-splitting most of your other images. That’s usually fine, because the next set of steps will try to lump colors together or remove minor details. You want to be just granular enough to capture the details you care about, and it’s okay if some colors are split up.</p>
<p>One thing to note is that the <code>bins</code> argument allows for a different number of bins for each channel. Setting <code>bins = 2</code> will divide each channel into 2 bins, but you can also set <code>bins = c(5, 2, 2)</code> to divide up the red channel into 5 bins and the blue and green channels into 2 bins (if in RGB space). This can be convenient if you have a lot of color diversity on only one axis, e.g. you have photographs of mammals which are shades of reddish-brown, and don’t need to waste computational time dividing up the blue channel.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># we can go from an unacceptable to an acceptable color map in </span>
<span class="co"># CIE Lab space by adding a single additional bin in the luminance channel:</span>
<span class="va">r_hist_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, method <span class="op">=</span> <span class="st">"hist"</span>, color_space <span class="op">=</span> <span class="st">"Lab"</span>, 
                     bins <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 2^3 = 8 total bins</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-6-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">r_hist_322</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, 
                     method <span class="op">=</span> <span class="st">"hist"</span>,
                     bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 3*2*2 = 12 bins</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-6-2.png" width="384" style="display: block; margin: auto;"></p>
</div>
</div>
<div class="section level3">
<h3 id="imposecolors">
<code>imposeColors()</code><a class="anchor" aria-label="anchor" href="#imposecolors"></a>
</h3>
<p>Another option is to impose colors on an image, rather than using intrinsic image colors. Every pixel is assigned to the color it is closest to in some specified color space. Usually, this is useful for batch processing: you get colors from one image, then map them onto another image, so that the color centers correspond across all your images in the same order.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">im1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ocellata.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span>
<span class="va">im2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/ephippigera.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span>

<span class="co"># fit the first image</span>
<span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">im1</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Using 2^3 = 8 total bins</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-7-1.png" width="384" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># fit the second image using colors from the first</span>
<span class="co"># adjust_centers = TRUE would find the average color of all the pixels assigned to </span>
<span class="co"># the imposed colors to better match the raw image</span>
<span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/imposeColors.html">imposeColors</a></span><span class="op">(</span><span class="va">im2</span>, <span class="va">fit1</span><span class="op">$</span><span class="va">centers</span>, adjust_centers <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p><img src="step02_initial_cluster_files/figure-html/unnamed-chunk-7-2.png" width="384" style="display: block; margin: auto;"></p>
<p>I would really only recommend using this if you’ve gotten your color centers from another image, but I mention it here because the function takes unclustered images.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Hannah Weller.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
