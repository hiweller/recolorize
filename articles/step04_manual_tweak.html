<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Step 4: Tweaks &amp; edits • recolorize</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Step 4: Tweaks &amp; edits">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recolorize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/step00_prep.html">Step 0: Image acquisition and preparation</a></li>
    <li><a class="dropdown-item" href="../articles/step01_loading.html">Step 1: Loading &amp; processing images</a></li>
    <li><a class="dropdown-item" href="../articles/step02_initial_cluster.html">Step 2: Initial clustering</a></li>
    <li><a class="dropdown-item" href="../articles/step03_refinement.html">Step 3: Refinement</a></li>
    <li><a class="dropdown-item" href="../articles/step04_manual_tweak.html">Step 4: Tweaks &amp; edits</a></li>
    <li><a class="dropdown-item" href="../articles/step05_visualization_export.html">Step 5: Exporting &amp; visualizing output</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hiweller/recolorize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Step 4: Tweaks &amp; edits</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/hiweller/recolorize/blob/master/vignettes/step04_manual_tweak.Rmd" class="external-link"><code>vignettes/step04_manual_tweak.Rmd</code></a></small>
      <div class="d-none name"><code>step04_manual_tweak.Rmd</code></div>
    </div>

    
    
<blockquote>
<p>Cleaning up the details.</p>
</blockquote>
<ul>
<li>
<a href="Introduction.html">Introduction</a><br>
</li>
<li>
<a href="step00_prep.html">Step 0: Image acquisition and
preparation</a><br>
</li>
<li>
<a href="step01_loading.html">Step 1: Loading &amp; processing
images</a><br>
</li>
<li>
<a href="step02_initial_cluster.html">Step 2: Initial
clustering</a><br>
</li>
<li>
<a href="step03_refinement.html">Step 3: Refinement</a><br>
</li>
<li>Step 4: Tweaks &amp; edits</li>
<li><a href="step05_visualization_export.html">Step 5: Visualizing &amp;
exporting output</a></li>
</ul>
<blockquote>
<p>You can also tour the functions in the <a href="https://hiweller.rbind.io/post/function-gallery-for-recolorize/" class="external-link">function
gallery</a>.</p>
</blockquote>
<p>These are functions that can be called individually to address
problem areas in specific images, or strung together as building blocks
to do more complicated operations. We’ll start with this <em>Chrysochroa
fulgidissima</em> image, which looks alright with a first pass using
<code>recolorize2</code>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://hiweller.github.io/recolorize/">recolorize</a></span><span class="op">)</span></span>
<span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/fulgidissima.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span></span>
<span><span class="va">ful_init</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize2.html">recolorize2</a></span><span class="op">(</span><span class="va">img</span>, bins <span class="op">=</span> <span class="fl">3</span>, cutoff <span class="op">=</span> <span class="fl">60</span>, plotting <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Using 3^3 = 27 total bins</span></span></code></pre></div>
<p><img src="step04_manual_tweak_files/figure-html/unnamed-chunk-3-1.png" width="384" style="display: block; margin: auto;"><img src="step04_manual_tweak_files/figure-html/unnamed-chunk-3-2.png" width="384" style="display: block; margin: auto;"></p>
<p>However, the angle of the iridescent green causes part of this patch
to be classified as dark brown/red (color 3), resulting in a long streak
and asymmetrical speckles of this color in the center of the image.</p>
<div class="section level3">
<h3 id="absorblayer">
<code>absorbLayer</code><a class="anchor" aria-label="anchor" href="#absorblayer"></a>
</h3>
<p>“Absorbs” all or part of a layer into the surrounding colors,
optionally according to a size or location condition.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ful_absorb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/absorbLayer.html">absorbLayer</a></span><span class="op">(</span><span class="va">ful_init</span>, layer_idx <span class="op">=</span> <span class="fl">3</span>, </span>
<span>                          <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;=</span> <span class="fl">250</span>,</span>
<span>                          y_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.8</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="step04_manual_tweak_files/figure-html/unnamed-chunk-4-1.png" width="480" style="display: block; margin: auto;"></p>
<p>This function is really useful, but fair warning: it can be quite
slow. It works by finding the color patch with which each separate
component shares the longest border and switching the component to that
color, which is more sophisticated than simply switching the patch
color, but requires many more calculations. If you find yourself using
this a lot, it’s a good idea to make sure you’ve downsampled your images
using the <code>resize</code> argument.</p>
</div>
<div class="section level3">
<h3 id="editlayereditlayers">
<code>editLayer</code>/<code>editLayers</code><a class="anchor" aria-label="anchor" href="#editlayereditlayers"></a>
</h3>
<p>Applies one of several morphological operations from
<code>imager</code> to a layer (or layers) of a <code>recolorize</code>
object. This can be used to despeckle, fill in holes, or uniformly grow
or shrink a color patch. In practice, this is mostly only useful for
fixing small imperfections; anything too drastic tends to alter the
overall shape of the patch.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># cleans up some of the speckles in the above output</span></span>
<span><span class="va">ful_clean</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/editLayers.html">editLayers</a></span><span class="op">(</span><span class="va">ful_init</span>, layer_idx <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                        operations <span class="op">=</span> <span class="st">"fill"</span>, px_sizes <span class="op">=</span> <span class="fl">3</span>, plotting <span class="op">=</span> <span class="cn">T</span><span class="op">)</span></span></code></pre></div>
<p><img src="step04_manual_tweak_files/figure-html/unnamed-chunk-5-1.png" width="384" style="display: block; margin: auto;"></p>
<p>This function is also easy to modify. Internally, it splits the color
map into individual masks using <code><a href="../reference/splitByColor.html">splitByColor()</a></code> (another
recolorize function), then converts those to pixsets for use in
<code>imager</code> before slotting them back in with the unchanged
layers.</p>
</div>
<div class="section level3">
<h3 id="mergelayers">
<code>mergeLayers</code><a class="anchor" aria-label="anchor" href="#mergelayers"></a>
</h3>
<p>Sometimes, you don’t want to define fancy rules for deciding which
layers to combine; you just want to combine layers. That’s what this
function is for. It takes in a list of numeric vectors for layers to
combine (layers in the same vector are combined; those in different list
elements are kept separate).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">corbetti</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/corbetti.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span></span>
<span><span class="va">rc</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/recolorize.html">recolorize</a></span><span class="op">(</span><span class="va">corbetti</span>, plotting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Using 2^3 = 8 total bins</span></span>
<span><span class="va">merge_fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mergeLayers.html">mergeLayers</a></span><span class="op">(</span><span class="va">rc</span>, </span>
<span>                         merge_list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span>, </span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">7</span><span class="op">)</span>,</span>
<span>                                           <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">6</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="step04_manual_tweak_files/figure-html/unnamed-chunk-6-1.png" width="480" style="display: block; margin: auto;"></p>
<p>You might notice this is a bit different than our
<code>recluster</code> results above. That’s because internally,
<code>recluster</code> actually uses <code>imposeColors</code> to refit
the color map, rather than just merging layers; I have found this often
produces slightly nicer results, because pixels that were on the border
of one cutoff or another don’t get stranded in the wrong layer. On the
other hand, <code>mergeLayers</code> is considerably faster.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hannah Weller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
