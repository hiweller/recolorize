<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="Absorb a layer into its surrounding color patches"><title>Absorb a layer into its surrounding color patches — absorbLayer • recolorize</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Absorb a layer into its surrounding color patches — absorbLayer"><meta property="og:description" content="Absorb a layer into its surrounding color patches"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">recolorize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Introduction.html">Introduction</a>
    <a class="dropdown-item" href="../articles/step00_prep.html">Step 0: Image acquisition and preparation</a>
    <a class="dropdown-item" href="../articles/step01_loading.html">Step 1: Loading &amp; processing images</a>
    <a class="dropdown-item" href="../articles/step02_initial_cluster.html">Step 2: Initial clustering</a>
    <a class="dropdown-item" href="../articles/step03_refinement.html">Step 3: Refinement</a>
    <a class="dropdown-item" href="../articles/step04_manual_tweak.html">Step 4: Tweaks &amp; edits</a>
    <a class="dropdown-item" href="../articles/step05_visualization_export.html">Step 5: Exporting &amp; visualizing output</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/hiweller/recolorize/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Absorb a layer into its surrounding color patches</h1>
      <small class="dont-index">Source: <a href="https://github.com/hiweller/recolorize/blob/HEAD/R/absorbLayer.R" class="external-link"><code>R/absorbLayer.R</code></a></small>
      <div class="d-none name"><code>absorbLayer.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Absorb a layer into its surrounding color patches</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">absorbLayer</span><span class="op">(</span>
  <span class="va">recolorize_obj</span>,
  <span class="va">layer_idx</span>,
  size_condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">s</span><span class="op">)</span> <span class="va">s</span> <span class="op">&lt;=</span> <span class="cn">Inf</span>,
  x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
  y_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>,
  highlight_color <span class="op">=</span> <span class="st">"yellow"</span>,
  remove_empty_layers <span class="op">=</span> <span class="cn">TRUE</span>,
  plotting <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>recolorize_obj</dt>
<dd><p>A <code>recolorize</code> object.</p></dd>
<dt>layer_idx</dt>
<dd><p>The numeric index of the layer to absorb.</p></dd>
<dt>size_condition</dt>
<dd><p>A condition for determining which components to absorb,
written as a function. The default (<code>function(l) l &lt;= Inf</code>) will affect
all components, since they all have fewer than infinity pixels.</p></dd>
<dt>x_range, y_range</dt>
<dd><p>The rectangular bounding box (as proportions of the
image width and length) for selecting patches. Patches with at least
partial overlap are counted. Defaults (0-1) include the entire image.
See details.</p></dd>
<dt>highlight_color</dt>
<dd><p>Color for highlighting the affected layer.</p></dd>
<dt>remove_empty_layers</dt>
<dd><p>Logical. If the layer is completely absorbed,
remove it from the layer indices and renumber the existing patches? (Example:
if you completely absorb layer 3, then layer 4 -&gt; 3 and 5 -&gt; 4, and so on).</p></dd>
<dt>plotting</dt>
<dd><p>Logical. Plot results?</p></dd>
</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A <code>recolorize</code> object.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>This function works by splitting a layer into spatially distinct
'components' using <a href="https://rdrr.io/pkg/imager/man/split_connected.html" class="external-link">imager::split_connected</a>. A contiguous region of pixels
is considered a single component. Only components which satisfy
both the <code>size_condition</code> and the location condition (specified via <code>x_range</code>
and <code>y_range</code>) are absorbed, so you can be target specific regions with
(ideally) a minimum of fuss.</p>
<p>The <code>size_condition</code> is passed as a function which must have a logical
vector output (<code>TRUE</code> and <code>FALSE</code>) when applied to a vector of sizes.
Usually this will be some combination of greater and less than statements,
combined with logical operators like <code>&amp;</code> and <code>|</code>. For example,
<code>size_condition = function(x) x &gt; 100 | x &lt; 10</code> would affect components of
greater than 100 pixels and fewer than 10 pixels, but not those with 10-100
pixels.</p>
<p>The <code>x_range</code> and <code>y_range</code> values set the bounding box of a rectangular
region as proportions of the image axes, with the origin (0, 0) in the bottom
left corner. Any patch which has at least partial overlap with this bounding
box will be considered to satisfy the condition. When selecting this region,
it can be helpful to plot a grid on the image first to narrow down an
approximate region (see examples).</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><a href="editLayers.html">editLayers</a> for editing layers using morphological operations;
<a href="thresholdRecolor.html">thresholdRecolor</a> for re-fitting the entire image without minor colors.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"></span>
<span class="r-in"><span class="co"># \donttest{</span></span>
<span class="r-in"><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata/fulgidissima.png"</span>, package <span class="op">=</span> <span class="st">"recolorize"</span><span class="op">)</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># get an initial fit using recolorize + recluster:</span></span>
<span class="r-in"><span class="va">fit1</span> <span class="op">&lt;-</span> <span class="fu"><a href="recolorize2.html">recolorize2</a></span><span class="op">(</span><span class="va">img</span>, bins <span class="op">=</span> <span class="fl">3</span>, cutoff <span class="op">=</span> <span class="fl">65</span>, plotting <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 3^3 = 27 total bins</span>
<span class="r-in"><span class="co"># this looks okay, but the brown patch (3) has some speckling</span></span>
<span class="r-in"><span class="co"># in the upper right elytron due to reflection, and the orange</span></span>
<span class="r-in"><span class="co"># patch (4) has the same issue</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># the brown patch is easier to deal with, since size thresholding alone is</span></span>
<span class="r-in"><span class="co"># sufficient; we want to leave the stripes intact, so we'll absorb components</span></span>
<span class="r-in"><span class="co"># that are 50-250 pixels OR fewer than 20 pixels (to get the tiny speckles),</span></span>
<span class="r-in"><span class="co"># leaving the eyes intact</span></span>
<span class="r-in"><span class="va">fit2</span> <span class="op">&lt;-</span> <span class="fu">absorbLayer</span><span class="op">(</span><span class="va">fit1</span>, layer_idx <span class="op">=</span> <span class="fl">3</span>,</span>
<span class="r-in">                    size_condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">&lt;=</span> <span class="fl">250</span> <span class="op">&amp;</span></span>
<span class="r-in">                      <span class="va">x</span> <span class="op">&gt;=</span> <span class="fl">50</span> <span class="op">|</span></span>
<span class="r-in">                      <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">20</span>,</span>
<span class="r-in">                    highlight_color <span class="op">=</span> <span class="st">"cyan"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="absorbLayer-1.png" alt="" width="700" height="433"></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># what about the orange speckles? this is more difficult, because</span></span>
<span class="r-in"><span class="co"># we want to retain the border around the brown stripes, but those patches</span></span>
<span class="r-in"><span class="co"># are quite small, so size thresholding won't work</span></span>
<span class="r-in"></span>
<span class="r-in"><span class="co"># but we just want to target pixels in that one region, so we can first</span></span>
<span class="r-in"><span class="co"># determine a bounding box for it by plotting a grid:</span></span>
<span class="r-in"><span class="fu"><a href="plotImageArray.html">plotImageArray</a></span><span class="op">(</span><span class="fu"><a href="constructImage.html">constructImage</a></span><span class="op">(</span><span class="va">fit2</span><span class="op">$</span><span class="va">pixel_assignments</span>,</span>
<span class="r-in">                    <span class="va">fit2</span><span class="op">$</span><span class="va">centers</span><span class="op">)</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">1</span>, line <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>; <span class="fu"><a href="https://rdrr.io/r/graphics/axis.html" class="external-link">axis</a></span><span class="op">(</span><span class="fl">2</span>, line <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span class="r-in"><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span class="r-in">       h <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span>,</span>
<span class="r-in">       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/gray.html" class="external-link">grey</a></span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span>,</span>
<span class="r-in">       lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span class="r-plt img"><img src="absorbLayer-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># x-axis range: 0.5-0.7</span></span>
<span class="r-in"><span class="co"># y-axis range: 0.55-0.75</span></span>
<span class="r-in"><span class="co"># let's try it:</span></span>
<span class="r-in"><span class="va">fit3</span> <span class="op">&lt;-</span> <span class="fu">absorbLayer</span><span class="op">(</span><span class="va">fit2</span>, layer_idx <span class="op">=</span> <span class="fl">4</span>,</span>
<span class="r-in">                    size_condition <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op">&lt;</span> <span class="fl">100</span>,</span>
<span class="r-in">                    x_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.5</span>, <span class="fl">0.7</span><span class="op">)</span>,</span>
<span class="r-in">                    y_range <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.55</span>, <span class="fl">0.75</span><span class="op">)</span>,</span>
<span class="r-in">                    highlight_color <span class="op">=</span> <span class="st">"yellow"</span><span class="op">)</span></span>
<span class="r-plt img"><img src="absorbLayer-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span class="co"># looks pretty good</span></span>
<span class="r-in"><span class="co"># }</span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Hannah Weller.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.3.</p>
</div>

    </footer></div>

  

  

  </body></html>

