<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Generate color clusters from an image — colorClusters • recolorize</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Generate color clusters from an image — colorClusters"><meta name="description" content="Clusters all the pixels in an image according to the specified method and
returns color centers, cluster assignments, and cluster sizes."><meta property="og:description" content="Clusters all the pixels in an image according to the specified method and
returns color centers, cluster assignments, and cluster sizes."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">recolorize</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/Introduction.html">Introduction</a></li>
    <li><a class="dropdown-item" href="../articles/step00_prep.html">Step 0: Image acquisition and preparation</a></li>
    <li><a class="dropdown-item" href="../articles/step01_loading.html">Step 1: Loading &amp; processing images</a></li>
    <li><a class="dropdown-item" href="../articles/step02_initial_cluster.html">Step 2: Initial clustering</a></li>
    <li><a class="dropdown-item" href="../articles/step03_refinement.html">Step 3: Refinement</a></li>
    <li><a class="dropdown-item" href="../articles/step04_manual_tweak.html">Step 4: Tweaks &amp; edits</a></li>
    <li><a class="dropdown-item" href="../articles/step05_visualization_export.html">Step 5: Exporting &amp; visualizing output</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/hiweller/recolorize/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Generate color clusters from an image</h1>
      <small class="dont-index">Source: <a href="https://github.com/hiweller/recolorize/blob/master/R/colorClusters.R" class="external-link"><code>R/colorClusters.R</code></a></small>
      <div class="d-none name"><code>colorClusters.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Clusters all the pixels in an image according to the specified method and
returns color centers, cluster assignments, and cluster sizes.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">colorClusters</span><span class="op">(</span></span>
<span>  <span class="va">bg_indexed</span>,</span>
<span>  method <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"histogram"</span>, <span class="st">"kmeans"</span><span class="op">)</span>,</span>
<span>  n <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  bins <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  color_space <span class="op">=</span> <span class="st">"Lab"</span>,</span>
<span>  ref_white <span class="op">=</span> <span class="st">"D65"</span>,</span>
<span>  bin_avg <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-bg-indexed">bg_indexed<a class="anchor" aria-label="anchor" href="#arg-bg-indexed"></a></dt>
<dd><p>A list returned by <code><a href="backgroundIndex.html">backgroundIndex()</a></code>.</p></dd>


<dt id="arg-method">method<a class="anchor" aria-label="anchor" href="#arg-method"></a></dt>
<dd><p>Binning scheme to use, one of either <code>kmeans</code> or <code>histogram</code>.
Produce very different results (see details).</p></dd>


<dt id="arg-n">n<a class="anchor" aria-label="anchor" href="#arg-n"></a></dt>
<dd><p>If <code>method = "kmeans"</code>, the number of colors to fit.</p></dd>


<dt id="arg-bins">bins<a class="anchor" aria-label="anchor" href="#arg-bins"></a></dt>
<dd><p>If <code>method = "histogram"</code>, either the number of bins per color
channel (if a single number is provided) OR a vector of length 3 with the
number of bins for each channel.</p></dd>


<dt id="arg-color-space">color_space<a class="anchor" aria-label="anchor" href="#arg-color-space"></a></dt>
<dd><p>Color space in which to cluster colors, passed to
<code>[grDevices]{convertColor}</code>. One of "sRGB", "Lab", or "Luv".
Default is "Lab", a perceptually uniform (for humans) color space.</p></dd>


<dt id="arg-ref-white">ref_white<a class="anchor" aria-label="anchor" href="#arg-ref-white"></a></dt>
<dd><p>Reference white for converting to different color spaces.
D65 (the default) corresponds to standard daylight.</p></dd>


<dt id="arg-bin-avg">bin_avg<a class="anchor" aria-label="anchor" href="#arg-bin-avg"></a></dt>
<dd><p>Logical. Return the color centers as the average of the pixels
assigned to the bin (the default), or the geometric center of the bin?</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list with the following elements:</p><ol><li><p><code>pixel_assignments</code>: A vector of color center assignments for
each pixel.</p></li>
<li><p><code>centers</code>: A matrix of color centers, in RGB color space.</p></li>
<li><p><code>sizes</code>: The number of pixels assigned to each cluster.</p></li>
</ol></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p><code><a href="https://rdrr.io/r/stats/kmeans.html" class="external-link">stats::kmeans()</a></code> clustering tries to find the set of <code>n</code> clusters
that minimize overall distances. Histogram binning divides up color space
according to set breaks; for example, bins = 2 would divide the red, green,
and blue channels into 2 bins each (&gt; 0.5 and &lt; 0 .5), resulting in 8
possible ranges. A white pixel (RGB = 1, 1, 1) would fall into the R \&gt; 0.5, G
\&gt; 0.5, B \&gt; 0.5 bin. The resulting centers represent the average color of all
the pixels assigned to that bin.</p>
<p>K-means clustering can produce more intuitive results, but because it is
iterative, it will find slightly different clusters each time it is run, and
their order will be arbitrary. It also tends to divide up similar colors that
make up the majority of the image. Histogram binning will produce the same
results every time, in the same order, and because it forces the bins to be
dispersed throughout color space, tends to better pick up small color
details. Bins are also comparable across images. However, this sometimes
means returning empty bins (i.e. the white bin will be empty if clustering a
very dark image).</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make a 100x100 'image' of random colors</span></span></span>
<span class="r-in"><span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html" class="external-link">array</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">30000</span><span class="op">)</span>, dim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">100</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotImageArray.html">plotImageArray</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="colorClusters-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># make a background index object:</span></span></span>
<span class="r-in"><span><span class="va">bg_indexed</span> <span class="op">&lt;-</span> <span class="fu"><a href="backgroundIndex.html">backgroundIndex</a></span><span class="op">(</span><span class="va">img</span>, <span class="fu"><a href="backgroundCondition.html">backgroundCondition</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> No pixels satisfying masking conditions; clustering all pixels</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># histogram clustering</span></span></span>
<span class="r-in"><span><span class="va">hist_clusters</span> <span class="op">&lt;-</span> <span class="fu">colorClusters</span><span class="op">(</span><span class="va">bg_indexed</span>, method <span class="op">=</span> <span class="st">"hist"</span>, bins <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 2^3 = 8 total bins</span>
<span class="r-in"><span><span class="fu"><a href="plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">hist_clusters</span><span class="op">$</span><span class="va">centers</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="colorClusters-2.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># we can use a different number of bins for each channel</span></span></span>
<span class="r-in"><span><span class="va">uneven_clusters</span> <span class="op">&lt;-</span> <span class="fu">colorClusters</span><span class="op">(</span><span class="va">bg_indexed</span>, method <span class="op">=</span> <span class="st">"hist"</span>,</span></span>
<span class="r-in"><span>                                 bins <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> Using 3*2*1 = 6 bins</span>
<span class="r-in"><span><span class="fu"><a href="plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">uneven_clusters</span><span class="op">$</span><span class="va">centers</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="colorClusters-3.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># using kmeans</span></span></span>
<span class="r-in"><span><span class="va">kmeans_clusters</span> <span class="op">&lt;-</span> <span class="fu">colorClusters</span><span class="op">(</span><span class="va">bg_indexed</span>, method <span class="op">=</span> <span class="st">"kmeans"</span>,</span></span>
<span class="r-in"><span>                                 n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plotColorPalette.html">plotColorPalette</a></span><span class="op">(</span><span class="va">kmeans_clusters</span><span class="op">$</span><span class="va">centers</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="colorClusters-4.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Hannah Weller.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

